{% extends 'web/base.html' %}
{% load humanize %}
{% load static %}

{% block title %}
  Home - UMSC Zakah & Sadaqa
{% endblock %}

{% block content %}
  <div class="container pt-1 pb-5">
    <!-- Hero Section with Carousel -->
    <div class="hero-section mb-3">
      <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="10000">
        <div class="carousel-indicators">
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="3"></button>
        </div>
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="https://images.unsplash.com/photo-1532629345422-7515f3d16bb6?auto=format&fit=crop&w=1600&h=600&q=80" class="d-block w-100" alt="Charity" />
            <div class="carousel-caption">
              <h2>Support Those in Need</h2>
              <p>Your contribution can make a difference in someone's life</p>
            </div>
          </div>
          <div class="carousel-item">
            <img src="https://images.unsplash.com/photo-1488521787991-ed7bbaae773c?auto=format&fit=crop&w=1600&h=600&q=80" class="d-block w-100" alt="Zakah" />
            <div class="carousel-caption">
              <h2>Pay Your Zakah</h2>
              <p>Fulfill your obligation and purify your wealth</p>
            </div>
          </div>
          <div class="carousel-item">
            <img src="https://images.unsplash.com/photo-1469571486292-0ba58a3f068b?auto=format&fit=crop&w=1600&h=600&q=80" class="d-block w-100" alt="Sadaqa" />
            <div class="carousel-caption">
              <h2>Give Sadaqa</h2>
              <p>Voluntary charity brings blessings and rewards</p>
            </div>
          </div>
          <div class="carousel-item">
            <img src="https://images.unsplash.com/photo-1509099836639-18ba1795216d?auto=format&fit=crop&w=1600&h=600&q=80" class="d-block w-100" alt="Community" />
            <div class="carousel-caption">
              <h2>Build Our Community</h2>
              <p>Together we can create positive change</p>
            </div>
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    </div>

    <div class="text-center my-5">
      <h1 class="display-4 fw-bold mt-3">Welcome to UMSC Zakah & Sadaqa</h1>
      <div class="quran-verse mb-4">
        <p class="arabic-text mb-2" style="font-size: 1.5rem; line-height: 2.5;">مَثَلُ الَّذِينَ يُنْفِقُونَ أَمْوَالَهُمْ فِي سَبِيلِ اللَّهِ كَمَثَلِ حَبَّةٍ أَنْبَتَتْ سَبْعَ سَنَابِلَ، فِي كُلِّ سُنْبُلَةٍ مِائَةُ حَبَّةٍ، وَاللَّهُ يُضَاعِفُ لِمَنْ يَشَاءُ، وَاللَّهُ وَاسِعٌ عَلِيمٌ</p>
        <p class="translation-text text-muted" style="font-size: 1.1rem;">"The example of those who spend their wealth in the way of Allah is like a seed [of grain] which grows seven spikes; in each spike is a hundred grains. And Allah multiplies [His reward] for whom He wills. And Allah is all-Encompassing and Knowing."</p>
        <p class="reference-text" style="font-size: 0.9rem; color: var(--primary-color);">Surah Al-Baqarah, 2:261</p>
      </div>
      <p class="lead text-muted">Support our community initiatives and make a difference</p>
    </div>

    <div class="row mb-5">
      {% for counter in counters %}
        <div class="col-md-4 mb-4">
          <div class="card boxy-card h-100">
            <div class="card-body text-center p-4">
              <div class="counter-icon mb-4">
                <div class="icon-circle">
                  <i class="bi bi-cash-stack"></i>
                </div>
              </div>
              <h3 class="card-title mb-3">{{ counter.get_contribution_type_display }}</h3>
              <div class="counter-stats">
                <div class="stat-item mb-3">
                  <i class="bi bi-people-fill me-2"></i>
                  <span class="stat-label">Contributions</span>
                  <h2 class="stat-value counter" data-count="{{ counter.count }}">0</h2>
                </div>
                <div class="stat-item">
                  <i class="bi bi-cash-stack me-2"></i>
                  <span class="stat-label">Total Amount</span>
                  <h2 class="stat-value currency counter" data-amount="{{ counter.total_amount }}">0</h2>
                </div>
              </div>
              <a href="{% url 'web:contribution_list' counter.contribution_type %}" class="btn btn-outline-primary mt-4"><i class="bi bi-list-ul me-2"></i>View Details</a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="row">
      <div class="col-md-4 mb-4">
        <div class="card boxy-card h-100">
          <div class="card-body text-center p-4">
            <div class="icon-circle mb-4">
              <i class="bi bi-cash-coin"></i>
            </div>
            <h3 class="card-title">Pay Zakah</h3>
            <p class="card-text">Fulfill your Zakah obligation and support those in need.</p>
            <a href="{% url 'web:pay_zakah' %}" class="btn btn-primary mt-3"><i class="bi bi-arrow-right-circle me-2"></i>Contribute Now</a>
          </div>
        </div>
      </div>
      <div class="col-md-4 mb-4">
        <div class="card boxy-card h-100">
          <div class="card-body text-center p-4">
            <div class="icon-circle mb-4">
              <i class="bi bi-gift"></i>
            </div>
            <h3 class="card-title">Pay Sadaqa</h3>
            <p class="card-text">Give voluntary charity and earn rewards from Allah.</p>
            <a href="{% url 'web:pay_sadaqa' %}" class="btn btn-primary mt-3"><i class="bi bi-arrow-right-circle me-2"></i>Contribute Now</a>
          </div>
        </div>
      </div>
      <div class="col-md-4 mb-4">
        <div class="card boxy-card h-100">
          <div class="card-body text-center p-4">
            <div class="icon-circle mb-4">
              <i class="bi bi-building"></i>
            </div>
            <h3 class="card-title">Ongoing Projects</h3>
            <p class="card-text">Support our community projects and initiatives.</p>
            <a href="{% url 'web:projects' %}" class="btn btn-primary mt-3"><i class="bi bi-arrow-right-circle me-2"></i>View Projects</a>
          </div>
        </div>
      </div>
    </div>

    {% if current_nisab %}
      <div class="row mb-5">
        <div class="col-12">
          <div class="card nisab-card">
            <div class="card-body p-0">
              <div class="row g-0">
                <div class="col-lg-4 nisab-highlight">
                  <div class="nisab-amount-wrapper">
                    <div class="nisab-label">Current Nisab Value</div>
                    <div class="nisab-amount">
                      <span class="currency">{{ current_nisab.currency }}</span>
                      <span class="amount">{{ current_nisab.amount|intcomma }}</span>
                    </div>
                    <div class="update-info">
                      <i class="bi bi-clock-history"></i>
                      Last updated: {{ current_nisab.last_updated|date:'d M Y' }}
                    </div>
                  </div>
                </div>
                <div class="col-lg-8 nisab-content">
                  <div class="nisab-info">
                    <h3><i class="bi bi-info-circle-fill me-2"></i>Understanding Nisab</h3>
                    <p class="mb-4">Nisab is the minimum amount of wealth a Muslim must possess before becoming eligible to pay Zakah. It is calculated based on the current value of gold or silver. If your wealth exceeds this amount, you are required to pay 2.5% of your eligible wealth as Zakah.</p>
                    <div class="nisab-actions">
                      <a href="{% url 'web:pay_zakah' %}" class="btn btn-primary me-3">
                        <i class="bi bi-calculator me-2"></i>Calculate Your Zakah
                      </a>
                      <a href="{% url 'web:pay_zakah' %}" class="btn btn-outline-primary">
                        <i class="bi bi-heart-fill me-2"></i>Pay Zakah Now
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %}

{% block extra_css %}
  <style>
    .hero-section {
      margin: -2rem -1rem 2rem -1rem;
      width: 100vw;
      position: relative;
      left: 50%;
      right: 50%;
      margin-left: -50vw;
      margin-right: -50vw;
    }
    
    .carousel {
      border-radius: 0;
      overflow: hidden;
      box-shadow: var(--box-shadow);
    }
    
    .carousel-item {
      height: 400px;
      background-color: #000;
      position: relative;
    }
    
    .carousel-item img {
      object-fit: cover;
      height: 100%;
      width: 100%;
      opacity: 0.7;
      position: absolute;
      top: 0;
      left: 0;
    }
    
    .carousel-caption {
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(5px);
      border-radius: var(--border-radius);
      padding: 2rem;
      bottom: 2rem;
      max-width: 600px;
      margin: 0 auto;
      left: 50%;
      transform: translateX(-50%);
      color: white;
    }
    
    .carousel-caption h2 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      color: white;
    }
    
    .carousel-caption p {
      font-size: 1.2rem;
      margin-bottom: 0;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      color: white;
    }
    
    .carousel-indicators {
      margin-bottom: 2rem;
    }
    
    .carousel-indicators button {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin: 0 5px;
      background-color: rgba(255, 255, 255, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.8);
    }
    
    .carousel-indicators button.active {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .carousel-control-prev,
    .carousel-control-next {
      width: 5%;
      opacity: 0;
      transition: var(--transition);
    }
    
    .carousel:hover .carousel-control-prev,
    .carousel:hover .carousel-control-next {
      opacity: 1;
    }
    
    @media (max-width: 768px) {
      .carousel-item {
        height: 300px;
      }
    
      .carousel-caption {
        padding: 1rem;
        bottom: 1rem;
      }
    
      .carousel-caption h2 {
        font-size: 1.8rem;
      }
    
      .carousel-caption p {
        font-size: 1rem;
      }
    }
    
    .icon-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: var(--success-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      color: var(--primary-color);
      font-size: 2rem;
      transition: transform 0.3s ease;
    }
    
    .card:hover .icon-circle {
      transform: scale(1.1);
    }
    
    .counter-stats {
      background-color: var(--success-bg);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .stat-item {
      padding: 10px 0;
    }
    
    .stat-label {
      display: block;
      font-size: 0.9rem;
      color: var(--primary-dark);
      margin-bottom: 5px;
    }
    
    .stat-value {
      font-size: 1.8rem;
      font-weight: 600;
      margin: 0;
      color: var(--primary-color);
    }
    
    .card-title {
      color: var(--primary-color);
      font-weight: 600;
    }
    
    .card-text {
      color: var(--text-color);
      line-height: 1.6;
    }
    
    .btn-primary {
      padding: 10px 25px;
      border-radius: 25px;
      font-weight: 500;
    }
    
    .btn-outline-primary {
      padding: 8px 20px;
      border-radius: 25px;
      font-weight: 500;
    }
    
    .quran-verse {
      max-width: 800px;
      margin: 0 auto;
      padding: 1.5rem;
      background-color: var(--success-bg);
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .arabic-text {
      font-family: 'Traditional Arabic', 'Arial', sans-serif;
      color: var(--primary-color);
    }
    
    .translation-text {
      font-style: italic;
    }
    
    .reference-text {
      font-weight: 500;
    }
    
    .nisab-card {
      border: none;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      background: white;
      margin-top: 2rem;
    }

    .nisab-highlight {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      padding: 3rem 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .nisab-highlight::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
      transform: skewX(-20deg) translateX(-100%);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      100% {
        transform: skewX(-20deg) translateX(100%);
      }
    }

    .nisab-amount-wrapper {
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .nisab-label {
      font-size: 1.2rem;
      font-weight: 500;
      margin-bottom: 1rem;
      opacity: 0.9;
    }

    .nisab-amount {
      margin-bottom: 1rem;
    }

    .nisab-amount .currency {
      font-size: 1.5rem;
      opacity: 0.8;
      margin-right: 0.5rem;
    }

    .nisab-amount .amount {
      font-size: 2.5rem;
      font-weight: 700;
      font-family: 'Poppins', sans-serif;
    }

    .update-info {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .update-info i {
      margin-right: 0.5rem;
    }

    .nisab-content {
      padding: 3rem;
    }

    .nisab-info h3 {
      color: var(--primary-color);
      font-size: 1.75rem;
      margin-bottom: 1.5rem;
      font-weight: 600;
    }

    .nisab-info p {
      color: var(--text-color);
      font-size: 1.1rem;
      line-height: 1.6;
    }

    .nisab-actions {
      margin-top: 2rem;
    }

    .nisab-actions .btn {
      padding: 0.8rem 1.5rem;
      font-weight: 500;
      border-radius: 50px;
    }

    @media (max-width: 991px) {
      .nisab-highlight {
        padding: 2rem;
      }

      .nisab-content {
        padding: 2rem;
      }

      .nisab-amount .amount {
        font-size: 2rem;
      }

      .nisab-info h3 {
        font-size: 1.5rem;
      }

      .nisab-actions .btn {
        display: block;
        width: 100%;
        margin-bottom: 1rem;
      }

      .nisab-actions .btn:last-child {
        margin-bottom: 0;
      }
    }
  </style>
{% endblock %}

{% block extra_js %}
  <script>
    // Initialize carousel with 10-second interval
    var carousel = new bootstrap.Carousel(document.getElementById('heroCarousel'), {
      interval: 10000
    })
    
    document.addEventListener('DOMContentLoaded', function () {
      // Function to animate counting
      function animateCounter(element, target, prefix = '') {
        let current = 0
        const duration = 2000 // 2 seconds
        const steps = 60
        const increment = target / steps
    
        const interval = setInterval(() => {
          current += increment
          if (current >= target) {
            current = target
            clearInterval(interval)
          }
          element.textContent = prefix + Math.floor(current).toLocaleString()
        }, duration / steps)
      }
    
      // Create an Intersection Observer to trigger animations when elements come into view
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const element = entry.target
              if (element.classList.contains('counter')) {
                if (element.classList.contains('currency')) {
                  animateCounter(element, parseInt(element.dataset.amount), 'UGX ')
                } else {
                  animateCounter(element, parseInt(element.dataset.count))
                }
                observer.unobserve(element) // Stop observing once animated
              }
            }
          })
        },
        { threshold: 0.5 }
      ) // Trigger when 50% of the element is visible
    
      // Observe all counter elements
      document.querySelectorAll('.counter').forEach((element) => {
        observer.observe(element)
      })
    })
  </script>
{% endblock %}

{{ block.super }}
